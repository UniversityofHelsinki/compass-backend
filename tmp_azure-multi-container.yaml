apiVersion: 2019-12-01
location: northeurope
name: compass-container-group
properties:
  containers:
    - name: compass-backend
      properties:
        environmentVariables: [
          {
            "name": "AZURE_NODEJS_IP",
            "value": "0.0.0.0"
          },
        ]
        image: quay.io/tike/compass-backend:main
        resources:
          requests:
            cpu: 1.0
            memoryInGb: 1.5
    - name: compass-caddy-server
      properties:
        image: quay.io/tike/compass-caddy-server:main
        ports: [
          {
            "port": 443
          }
        ]
        resources:
          requests:
            cpu: 1.0
            memoryInGb: 1.5
        volumeMounts:
          - name: caddy-certs
            mountPath: /data
  osType: Linux
  restartPolicy: Always
  ipAddress:
    dnsNameLabel: compass-backend-dns
    type: Public
    ports:
      - protocol: tcp
        port: 443
  volumes:
    - name: caddy-certs
      azureFile:
        shareName: certs
        storageAccountName: selfreflectioncompass
        storageAccountKey: ${STORAGE_ACCOUNT_KEY}
